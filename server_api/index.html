<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Server API - MZBench Docs</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/custom.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">MZBench Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Overview</a>
                    </li>
                
                
                
                    <li >
                        <a href="../scenarios/">Scenarios</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Server API</a>
                    </li>
                
                
                
                    <li >
                        <a href="../deployment_guide/">Deployment</a>
                    </li>
                
                
                
                    <li >
                        <a href="../workers/">Workers</a>
                    </li>
                
                
                
                    <li >
                        <a href="../cloud_plugin/">Cloud Plugins</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../scenarios/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../deployment_guide/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="http://github.com/machinezone/mzbench/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#mzbench-server-api">MZBench server API</a></li>
        
            <li><a href="#endpoints">Endpoints</a></li>
        
            <li><a href="#conventions">Conventions</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="mzbench-server-api">MZBench server API<a class="headerlink" href="#mzbench-server-api" title="Permanent link">&para;</a></h1>
<p>API allows driving bench execution and gathering metrics. It can&rsquo;t execute scripts locally or validate because these functions are not remote. As other HTTP APIs it has some endpoints and POST/GET parameters. Please notice that if log/metric compression is enabled at server.config &ndash; you need to be able to handle compressed answers from MZBench server.</p>
<p>Most of the requests return JSON objects, in case of an error it has &ldquo;reason&rdquo; &ndash; error text and &ldquo;reason_code&rdquo; &ndash; short error textual id.</p>
<p>API requests can be debugged with curl utility, for example:</p>
<pre><code>$ curl http://mzbench.myserver.com/logs?id=777
{"reason_code":"not_found","reason":"Benchmark 777 is not found"}

$ curl http://mzbench.myserver.com/status?id=1236
{"status":"complete","start_time":"2015-02-10T21:10:34Z","finish_time":"2015-02-10T22:17:06Z"}
</code></pre>
<h2 id="endpoints">Endpoints<a class="headerlink" href="#endpoints" title="Permanent link">&para;</a></h2>
<h3 id="post-startnodes">POST /start?nodes=&hellip;<a class="headerlink" href="#post-startnodes" title="Permanent link">&para;</a></h3>
<p>Asyncronous bench start, the only required POST parameter is file to be executed, it should be named &ldquo;bench&rdquo;, follow <a href="doc/scenario_dsl.md">DSL Reference</a> to learn how to write such files.</p>
<p>Optional query parameters:</p>
<ul>
<li>nodes &ndash; the number of nodes to be allocated or a comma-separated list of nodes to be used (for pre-allocated cluster), default is 1.</li>
<li>node_commit &ndash; commit or branch to be used for node. It is useful when you need to run different versions of the node with one server.</li>
<li>deallocate_after_bench &ndash; whether nodes require to be deallocated after the execution has finished. This option can be &ldquo;true&rdquo; or &ldquo;false&rdquo;, default is &ldquo;true&rdquo;.</li>
<li>provision_nodes &ndash; whether software installation is required for nodes. In some cases, you already have MZBench installed and you do not need to reinstall it, default is &ldquo;true&rdquo;.</li>
<li>benchmark_name &ndash; set benchmark name.</li>
</ul>
<p>In a case of success, response is JSON object contains &ldquo;id&rdquo; and &ldquo;status&rdquo; fields.</p>
<p>Examples:</p>
<pre><code># start scenario.erl on five cloud nodes
curl -XPOST --form bench=@scenario.erl http://mzbench.myserver.com/start?nodes=5
{"status":"pending","id":122}

# start scenario.erl on five preallocated nodes (n1 .. n5)
curl -XPOST --form bench=@scenario.erl http://mzbench.myserver.com/start?nodes=n1,n2,n3,n4,n5

# start scenario.erl using node from a personal branch
curl -XPOST --form bench=@scenario.erl http://mzbench.myserver.com/start?node_commit=my_branch

# start scenario.erl and disable cloud nodes deallocation for debugging purposes
curl -XPOST --form bench=@scenario.erl http://mzbench.myserver.com/start?deallocate_after_bench

# start scenario.erl using node from a personal branch
curl -XPOST --form bench=@scenario.erl http://mzbench.myserver.com/start?node_commit=my_branch
</code></pre>
<h3 id="get-statusidnumber">GET /status?id=number<a class="headerlink" href="#get-statusidnumber" title="Permanent link">&para;</a></h3>
<p>Request bench status, response fields are &ldquo;status&rdquo;, &ldquo;start_time&rdquo; and &ldquo;finish_time&rdquo;.</p>
<p>Example:</p>
<pre><code>curl 'http://mzbench.myserver.com/status?id=122'
{"status":"complete","start_time":"2015-08-12T07:25:42Z","finish_time":"2015-08-12T07:26:29Z"}
</code></pre>
<h3 id="get-stopidnumber">GET /stop?id=number<a class="headerlink" href="#get-stopidnumber" title="Permanent link">&para;</a></h3>
<p>Stop requested benchmark, in a case of success, response JSON object will contain the only field &ldquo;status&rdquo;.</p>
<h3 id="get-restartidnumber">GET /restart?id=number<a class="headerlink" href="#get-restartidnumber" title="Permanent link">&para;</a></h3>
<p>Clone and start one of the previously executes scenarios. The only parameter is an id of a bench to be cloned. Response is similar to &ldquo;/start&rdquo; function.</p>
<h3 id="get-logsidnumber">GET /logs?id=number<a class="headerlink" href="#get-logsidnumber" title="Permanent link">&para;</a></h3>
<p>Request benchmark logs, in a case of success, response will be plain bench log text. If the bench is still running, log will be streamed continuously until it finishes.</p>
<h3 id="get-dataidnumber">GET /data?id=number<a class="headerlink" href="#get-dataidnumber" title="Permanent link">&para;</a></h3>
<p>Request benchmark data, in a case of success, response will be tab-delimited CSV with timestamp followed by metric name and value, for example:</p>
<pre><code>curl http://mzbench.myserver.com/data?id=1236
1439245024  mzb.workers.failed.value    0
1439245024  mzb.workers.failed.rps.value    0.0
1439245024  mzb.workers.started.value   2000
</code></pre>
<p>Metric data for running benches is streamed in the same manner as logs.</p>
<h2 id="conventions">Conventions<a class="headerlink" href="#conventions" title="Permanent link">&para;</a></h2>
<ul>
<li>Bench id is a non-negative integer</li>
<li>Status is a string, allowed values are: &ldquo;pending&rdquo;, &ldquo;running&rdquo;, &ldquo;complete&rdquo;, &ldquo;failed&rdquo;, &ldquo;stopped&rdquo;</li>
<li>Date is a string in ISO 8601 format, like this: &ldquo;2015-08-12T07:25:42Z&rdquo;</li>
</ul></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
