<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Scenario DSL Specification - MZBench Docs</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/custom.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">MZBench Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Overview</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Scenarios <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../tutorial/">How to Write a Scenario</a>
</li>

                        
                            
<li class="active">
    <a href="./">Scenario DSL Specification</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../cli/">CLI</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../api/">API</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../deployment/">Deployment</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../cloud_plugins/">Cloud Plugins</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../workers/">Workers</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../tutorial/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../cli/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="http://github.com/machinezone/mzbench/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#directives">Directives</a></li>
        
            <li><a href="#top-level-directives">Top-Level Directives</a></li>
        
    
        <li class="main "><a href="#pools">Pools</a></li>
        
            <li><a href="#pool-options">Pool Options</a></li>
        
    
        <li class="main "><a href="#loops">Loops</a></li>
        
            <li><a href="#loop-options">Loop options</a></li>
        
    
        <li class="main "><a href="#resource-files">Resource Files</a></li>
        
    
        <li class="main "><a href="#standard-library">Standard Library</a></li>
        
            <li><a href="#environment-variables">Environment Variables</a></li>
        
            <li><a href="#parallelization-and-syncing">Parallelization and Syncing</a></li>
        
            <li><a href="#errors-handling">Errors Handling</a></li>
        
            <li><a href="#randomization">Randomization</a></li>
        
            <li><a href="#logging">Logging</a></li>
        
            <li><a href="#data-conversion">Data Conversion</a></li>
        
            <li><a href="#pause">Pause</a></li>
        
    
        <li class="main "><a href="#conventions">Conventions</a></li>
        
            <li><a href="#multipliers">Multipliers</a></li>
        
            <li><a href="#time_1">Time</a></li>
        
            <li><a href="#rate_1">Rate</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>In MZBench, scenarios are .bdl files written in a special DSL (domain specific language). BDL stands for Benchmark Definition Language. Think of it as a simple ident-based (like python) language with a small set of instructions and measurement units.</p>
<p>MZBench test scenarios consist of function calls and multi-line statements. Function name is <em>identifier</em>. Indetifier is lower-case letter sequence with numbers and underscore which starts from letter. Function could accept positional arguments or key arguments. Position arguments are values, key arguments are keys with values, for example:</p>
<pre><code class="python">multiline(param1 = 10, param2 = 20):
    function1(1, 2)
    function2(param1 = function3(1), param2 = 2)
    ...
</code></pre>

<p>Function value could be used in some cases, in the example above <code>function3</code> value is used to pass to function2.</p>
<p>Some statements only appear at the top level of a scenario. They&rsquo;re called <em>top-level statements</em>. There&rsquo;re two kinds of top-level statements: <a href="#directives">directives</a> and <a href="#pools">pools</a>.</p>
<p><a href="https://github.com/machinezone/mzbench/tree/master/examples.bdl">See live examples of MZBench scenarios on GitHub →</a></p>
<h1 id="directives">Directives<a class="headerlink" href="#directives" title="Permanent link">&para;</a></h1>
<p><strong>Directives</strong> prepare the system for the benchmark and clean up after. It includes installing an external <a href="../../workers/">worker</a> on test nodes, registering resource files, checking conditions, and executing shell commands before and after the test.</p>
<h2 id="top-level-directives">Top-Level Directives<a class="headerlink" href="#top-level-directives" title="Permanent link">&para;</a></h2>
<p>All top-level directives are optional.</p>
<h3 id="make_install-git">make_install git<a class="headerlink" href="#make_install-git" title="Permanent link">&para;</a></h3>
<pre><code class="python">make_install(git = &quot;&lt;URL&gt;&quot;, branch = &quot;&lt;Branch&gt;&quot;, dir = &quot;&lt;Dir&gt;&quot;)
</code></pre>

<p>Install an external worker from a remote git repository on the test nodes before running the benchmark.</p>
<p>MZBench downloads the worker and builds a .tgz archive, which is then distributed among the nodes and used in future provisions.</p>
<p>The following actions are executed during <code>make_install</code>:</p>
<pre><code class="bash">$ git clone &lt;URL&gt; temp_dir
$ cd temp_dir
$ git checkout &lt;Branch&gt;
$ cd &lt;Dir&gt;
$ make generate_tgz
</code></pre>

<p>If <code>branch</code> is not specified, the default git branch is used.</p>
<p>If <code>dir</code> is not specified, <code>.</code> is used.</p>
<h3 id="make_install-rsync">make_install rsync<a class="headerlink" href="#make_install-rsync" title="Permanent link">&para;</a></h3>
<pre><code class="python">make_install(rsync = &quot;&lt;location&gt;&quot;, exclude = &quot;&lt;subdir&gt;&quot;)
</code></pre>

<p>Install an external worker with rsync on the test nodes before running the benchmark. Unlike git <code>make_install</code>, rsync does not cache worker code.</p>
<h3 id="defaults">defaults<a class="headerlink" href="#defaults" title="Permanent link">&para;</a></h3>
<pre><code class="python">defaults(&quot;&lt;VarName1&gt;&quot; = &lt;Value1&gt;, &quot;&lt;VarName2&gt;&quot; = &lt;Value2&gt;, ...)
</code></pre>

<p>Allows to define the default values for environment variables, i.e. the values used if no value was provided for this variable on the command line.</p>
<p>See <a href="#environment-variables">Environment Variables</a> for additional information.</p>
<h3 id="include_resource">include_resource<a class="headerlink" href="#include_resource" title="Permanent link">&para;</a></h3>
<pre><code class="python">include_resource(&lt;ResourceName&gt;, &quot;&lt;FileName&gt;&quot;, &lt;Type&gt;)
include_resource(&lt;ResourceName&gt;, &quot;&lt;FileURL&gt;&quot;, &lt;Type&gt;)
</code></pre>

<p>Register a <a href="#resource-files">resource file</a> as <code>&lt;ResourceName&gt;</code>.</p>
<p>If the file is on your local machine, put it in the same directory where your scenario is.</p>
<p><strong><code>&lt;Type&gt;</code></strong> is one of the following atoms:</p>
<dl>
<dt><code>text</code></dt>
<dd>Plain text file, interpreted as a single string.</dd>
<dt><code>json</code></dt>
<dd>JSON file. Lists are interpreted as <a href="http://www.erlang.org/doc/man/lists.html">Erlang lists</a>, objects are interpreted as <a href="http://www.erlang.org/doc/man/maps.html">Erlang maps</a>.</dd>
<dt><code>tsv</code></dt>
<dd>File with tabulation separated values, interpreted as a list of lists.</dd>
<dt><code>erlang</code></dt>
<dd>Erlang source file, interpreted directly as an <a href="http://erlang.org/doc/reference_manual/expressions.html#id77790">Erlang term</a>.</dd>
<dt><code>binary</code></dt>
<dd>Custom binary (image, executable, archive, etc.), not interpreted.</dd>
</dl>
<h3 id="pre_hook-and-post_hook">pre_hook and post_hook<a class="headerlink" href="#pre_hook-and-post_hook" title="Permanent link">&para;</a></h3>
<pre><code class="python">pre_hook():
    &lt;Actions&gt;
post_hook():
    &lt;Actions&gt;
</code></pre>

<p>Run actions before and after the benchmark. Two kinds of actions are supported: <em>exec commands</em> and <em>worker calls</em>:</p>
<pre><code>Actions = Action1
          Action2
          ...
Action = exec(Target, BashCommand)
    | worker_call(WorkerMethod, WorkerModule)
    | worker_call(WorkerMethod, WorkerModule, WorkerType)
Target = all | director
</code></pre>
<p><strong>Exec commands</strong> let you to run any shell command on all nodes or only on the director node.</p>
<p><strong>Worker calls</strong> are functions defined by the worker. They can be executed only on the director node. Worker calls are used to update the <a href="#environment-variables">environment variables</a> used in the benchmark. An example is available in dummy_worker <a href="https://github.com/machinezone/mzbench/blob/master/node/apps/dummy_worker/src/dummy_worker.erl#L30">code</a>.</p>
<h3 id="assert">assert<a class="headerlink" href="#assert" title="Permanent link">&para;</a></h3>
<pre><code class="python">assert(always, &lt;Expression&gt;)
assert(&lt;Time&gt;, &lt;Expression&gt;)
</code></pre>

<p>Check if the condition <code>&lt;Expression&gt;</code> is satisfied throughout the entire benchmark or at least for the amount of time <a href="#time_1"><code>&lt;Time&gt;</code></a>.</p>
<p><code>&lt;Expression&gt;</code> is a logical expression composed of conditions <code>&lt;Operand1&gt; &lt;Operation&gt; &lt;Operand2&gt;</code> with binary (and, or), unary (not) logical operators and parenthesis.</p>
<p><code>&lt;Operation&gt;</code> is one of four atoms:</p>
<dl>
<dt><code>&lt;</code></dt>
<dd>Less than.</dd>
<dt><code>&gt;</code></dt>
<dd>Greater than.</dd>
<dt><code>&lt;=</code></dt>
<dd>Less than or equal to.</dd>
<dt><code>&gt;=</code></dt>
<dd>Greater than or equal to.</dd>
<dt><code>==</code></dt>
<dd>Equal to.</dd>
<dt><code>!=</code></dt>
<dd>Not equal to.</dd>
</dl>
<p><code>&lt;Operand1&gt;</code> and <code>&lt;Operand2&gt;</code> are the values to compare. They can be integers, floats, or <em>metrics</em> wildcards.</p>
<p><a href="../../workers/#metrics">Metrics</a> are numerical values collected by the worker during the benchmark. To get the metric value, put its name between double quotation marks:</p>
<pre><code class="python">(&quot;h*k&quot; &gt; 20) and (not &quot;http_ok&quot; &gt; 100)
</code></pre>

<p>The <code>http_ok</code> metric is provided by the <a href="https://github.com/machinezone/mzbench/blob/master/workers/simple_http/src/simple_http_worker.erl">simple_http</a> worker. This condition passes if the number of successful HTTP responses is greater than 20.</p>
<p>When multiple metrics are matched against wildcard, condition is checked for every matched metric.</p>
<p>Please note that signals are automatically converted to gauges and could be also used for asserts.</p>
<h1 id="pools">Pools<a class="headerlink" href="#pools" title="Permanent link">&para;</a></h1>
<p><strong>Pool</strong> represents a sequence of <strong>jobs</strong>—statements to run. The statements are defined by the <a href="../../workers/">worker</a> and <a href="#standard-library">MZBench&rsquo;s standard library</a>. The jobs are evenly distributed between nodes, so they can be executed in parallel.</p>
<p>Here&rsquo;s a pool that sends HTTP GET requests to two sites on 10 nodes in parallel:</p>
<pre><code class="python">    pool(size = 10, worker_type = simple_http_worker):
        get(&quot;http://example.com&quot;)
        get(&quot;http://foobar.com&quot;)
</code></pre>

<p>The <code>get</code> statement is provided by the built-in <a href="https://github.com/machinezone/mzbench/blob/master/workers/simple_http/src/simple_http_worker.erl">simple_http</a> worker.</p>
<p>The first param in the <code>pool</code> statement is a list of <em>pool options</em>.</p>
<h2 id="pool-options">Pool Options<a class="headerlink" href="#pool-options" title="Permanent link">&para;</a></h2>
<h3 id="size">size<a class="headerlink" href="#size" title="Permanent link">&para;</a></h3>
<p><em>required</em></p>
<pre><code class="python">size = &lt;NumberOfJobs&gt;
</code></pre>

<p>How many times you want the pool executed.</p>
<p>If there&rsquo;s enough nodes and <code>worker_start</code> is not set, MZBench will start the jobs simultaneously and run them in parallel.</p>
<p><strong><code>&lt;NumberOfJobs&gt;</code></strong> is any positive number.</p>
<h3 id="worker_type">worker_type<a class="headerlink" href="#worker_type" title="Permanent link">&para;</a></h3>
<p><em>required</em></p>
<pre><code class="python">worker_type = &lt;WorkerName&gt;
</code></pre>

<p>The worker that provides statements for the jobs.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>A pool uses exactly one worker. If you need multiple workers in the benchmark, just write a pool for each one.</p>
</div>
<h3 id="worker_start">worker_start<a class="headerlink" href="#worker_start" title="Permanent link">&para;</a></h3>
<pre><code class="python">worker_start = linear(&lt;Rate&gt;)
worker_start = poisson(&lt;Rate&gt;)
worker_start = exp(&lt;Scale&gt;, &lt;Time&gt;)
worker_start = pow(&lt;Exponent&gt;, &lt;Scale&gt;, &lt;Time&gt;)
</code></pre>

<p>Start the jobs with a given rate:</p>
<dl>
<dt><code>linear</code></dt>
<dd>Constant rate <a href="#rate_1"><code>&lt;Rate&gt;</code></a>, e.g. 10 per minute.</dd>
<dt><code>poisson</code></dt>
<dd>Rate defined by a <a href="http://en.wikipedia.org/wiki/Poisson_process">Poisson process</a> with λ = <a href="#rate_1"><code>&lt;Rate&gt;</code></a>.</dd>
<dt><code>exp</code></dt>
<dd>
<p>Start jobs with <a href="https://en.wikipedia.org/wiki/Exponential_growth">exponentially growing</a> rate with the scale factor <code>&lt;Scale&gt;</code>:</p>
<p><em>Scale × e<sup>Time</sup></em></p>
</dd>
<dt><code>pow</code></dt>
<dd>
<p>Start jobs with rate growing as a <a href="https://en.wikipedia.org/wiki/Power_function">power function</a> with the exponent <code>&lt;Exponent&gt;</code> and the scale factor <code>&lt;Scale&gt;</code>:</p>
<p><em>Scale × Time<sup>Exponent</sup></em></p>
</dd>
</dl>
<h3 id="ramp">ramp<a class="headerlink" href="#ramp" title="Permanent link">&para;</a></h3>
<pre><code class="python">ramp(linear, &lt;StartRate&gt;, &lt;EndRate&gt;)
</code></pre>

<p>Linearly change the rate from <a href="#rate_1"><code>&lt;StartRate&gt;</code></a> at the beginning of the pool to <a href="#rate_1"><code>&lt;EndRate&gt;</code></a> at its end.</p>
<h3 id="comb">comb<a class="headerlink" href="#comb" title="Permanent link">&para;</a></h3>
<pre><code class="python">comb(&lt;Rate1&gt;, &lt;Time1&gt;, &lt;Rate2&gt;, &lt;Time2&gt;, ...)
</code></pre>

<p>Start jobs with rate <a href="#rate_1"><code>&lt;Rate1&gt;</code></a> for <a href="#time_1"><code>&lt;Time1&gt;</code></a>, then switch to <a href="#rate_1"><code>&lt;Rate2&gt;</code></a> for <a href="#time_1"><code>&lt;Time2&gt;</code></a>, etc.</p>
<h1 id="loops">Loops<a class="headerlink" href="#loops" title="Permanent link">&para;</a></h1>
<p><strong>Loop</strong> is a sequence of statements executed over and over for a given time.</p>
<p>A loop looks similar to a <a href="#pools">pool</a>—it consists of a list of <a href="#loop options">options</a> and a list statements to run:</p>
<pre><code class="python">loop(time = &lt;Time&gt;,
     rate = &lt;Rate&gt;,
     parallel = &lt;N&gt;,
     iterator = &lt;Name&gt;,
     spawn = &lt;Spawn&gt;,
     while = &lt;Condition&gt;):
    &lt;Statement1&gt;
    &lt;Statement2&gt;
    ...
</code></pre>

<p>Here&rsquo;s a loop that sends HTTP GET requests for 30 seconds with a growing rate of 1 → 5 rps:</p>
<pre><code class="python">loop(time = 30 sec,
     rate = ramp(linear, 1 rps, 5 rps)):
        get(&quot;http://example.com&quot;)
</code></pre>

<p>You can put loops inside loops. Here&rsquo;s a nested loop that sends HTTP GET requests for 30 seconds, increasing the rate by 1 rps every three seconds:</p>
<pre><code class="python">loop(time = 30 sec,
     rate = 10 rpm,
     iterator = &quot;i&quot;):
        loop(time = 3 sec,
             rate = var(&quot;i&quot;) rps):
                get(&quot;http://google.com&quot;)
</code></pre>

<p>The difference between these two examples is that in the first case the rate is growing smoothly and in the second one it&rsquo;s growing in steps.</p>
<h2 id="loop-options">Loop options<a class="headerlink" href="#loop-options" title="Permanent link">&para;</a></h2>
<h3 id="time">time<a class="headerlink" href="#time" title="Permanent link">&para;</a></h3>
<p><em>required</em></p>
<pre><code class="python">time = &lt;Time&gt;
</code></pre>

<p>Run the loop for <a href="#time_1"><code>&lt;Time&gt;</code></a>.</p>
<h3 id="rate">rate<a class="headerlink" href="#rate" title="Permanent link">&para;</a></h3>
<pre><code class="python">rate = &lt;Rate&gt;
</code></pre>

<p>Repeat the loop with the <a href="#rate_1"><code>&lt;Rate&gt;</code></a> rate.</p>
<h3 id="think_time">think_time<a class="headerlink" href="#think_time" title="Permanent link">&para;</a></h3>
<pre><code class="python">think_time = [&lt;Time&gt;, &lt;Rate&gt;]
</code></pre>

<p>Start jobs with rate <a href="#rate_1"><code>&lt;Rate&gt;</code></a> for a second, then sleep for <a href="#time_1"><code>&lt;Time&gt;</code></a> and repeat.</p>
<h3 id="parallel">parallel<a class="headerlink" href="#parallel" title="Permanent link">&para;</a></h3>
<pre><code class="python">parallel = &lt;N&gt;
</code></pre>

<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>When parallel loop starts, all workers copy initial thread state. When loop ends all state copies but first are ommited. This note also applies to <code>spawn</code> mode below.</p>
</div>
<p>Run <code>&lt;N&gt;</code> iterations of the loop in parallel.</p>
<h3 id="iterator">iterator<a class="headerlink" href="#iterator" title="Permanent link">&para;</a></h3>
<pre><code class="python">iterator = &quot;&lt;IterName&gt;&quot;
</code></pre>

<p>Define a variable named <code>&lt;IterName&gt;</code> inside the loop that contains the current iteration number. It can be accessed with <code>var(&lt;IterName&gt;)</code>.</p>
<h3 id="spawn">spawn<a class="headerlink" href="#spawn" title="Permanent link">&para;</a></h3>
<pre><code class="python">spawn = (true|false)
</code></pre>

<p>If <code>true</code>, every iteration runs in a separate, spawned process. Default is <code>false</code>.</p>
<h3 id="while">while<a class="headerlink" href="#while" title="Permanent link">&para;</a></h3>
<pre><code class="python">while = &lt;Condition&gt;
</code></pre>

<p>Run this loop while condition is specified. Condition is some metric name compared with <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code> and <code>==</code>. For example <code>"print" &lt; 10</code>. The syntax is similar to <a href="#assert">asserts</a>. Please note that metrics are updated once in a 10 seconds (by default), if you set condition for print being less than 10 it does not guarantee print to be equal to 11 after the loop. In this case, &ldquo;print&rdquo; could be any number greater than 10 depending on how fast is your loop.</p>
<p>Loop conditions are different from global asserts in a two aspects: there is no time-limiting for loop ones and they do not terminate the entire worker thread. If loop assert is not satisfied, your script won&rsquo;t be <code>failed</code>.</p>
<h1 id="resource-files">Resource Files<a class="headerlink" href="#resource-files" title="Permanent link">&para;</a></h1>
<p><strong>Resource file</strong> is an external data source for the benchmark.</p>
<p>To declare a resource file for the benchmark, use <a href="#include-resource"><code>include_resource</code></a>.</p>
<p>Once the resource file is registered, its content can be included at any place in the scenario using the <code>resource</code> statement: <code>resource(&lt;ResourceName&gt;)</code>.</p>
<p>For example, suppose we have a file <code>names.json</code>:</p>
<pre><code>[
    "Bob",
    "Alice",
    "Guido"
]
</code></pre>
<p>Here&rsquo;s how you can use this file in a scenario:</p>
<pre><code class="python">include_resource(names, &quot;names.json&quot;, json)
pool(size = 3,
     worker_type = dummy_worker):
    loop(time = 5 sec,
         rate = 1 rps):
        print(choose(resource(names))) # print a random name from the file
</code></pre>

<h1 id="standard-library">Standard Library<a class="headerlink" href="#standard-library" title="Permanent link">&para;</a></h1>
<h2 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">&para;</a></h2>
<p><strong>Environment variables</strong> are global values that can be accessed at any point of the benchmark. They are useful to store the benchmark global state like its total duration, or global params like the execution speed.</p>
<p>To set an environment variable, call <code>mzbench</code> with the <code>--env</code> param:</p>
<pre><code class="bash">$ ./bin/mzbench run --env foo=bar --env n=42
</code></pre>

<h3 id="var">var<a class="headerlink" href="#var" title="Permanent link">&para;</a></h3>
<pre><code class="python">var(&quot;&lt;VarName&gt;&quot;)
</code></pre>

<p>To get the value of a variable, refer to it by the name: <code>var("&lt;VarName&gt;")</code>.</p>
<pre><code class="python">var(&quot;foo&quot;) # returns &quot;bar&quot;
var(&quot;n&quot;) # returns &quot;42&quot;, a string
</code></pre>

<p>If you refer to an undefined variable, the benchmark crashes. You can avoid this by setting a default value for the variable, see <a href="#defaults">defaults top-level directive</a>.</p>
<h3 id="numvar">numvar<a class="headerlink" href="#numvar" title="Permanent link">&para;</a></h3>
<pre><code class="python">numvar(&quot;&lt;VarName&gt;&quot;)
</code></pre>

<p>By default, variable values are considered strings. To get a numerical value (integer or float), use <code>numvar("VarName")</code>:</p>
<pre><code class="python">numvar(&quot;n&quot;) # returns 42, an integer.
</code></pre>

<h2 id="parallelization-and-syncing">Parallelization and Syncing<a class="headerlink" href="#parallelization-and-syncing" title="Permanent link">&para;</a></h2>
<h3 id="parallel_1">parallel<a class="headerlink" href="#parallel_1" title="Permanent link">&para;</a></h3>
<pre><code class="python">parallel():
    thread():
        &lt;Statement1&gt;
    thread():
        &lt;Statement2&gt;
    ...
</code></pre>

<p>Execute multiple statements in parallel. Unlike executing statements in a pool, this way all statements are executed on the same node.</p>
<h3 id="set_signal">set_signal<a class="headerlink" href="#set_signal" title="Permanent link">&para;</a></h3>
<pre><code class="python">set_signal(&lt;SignalName&gt;)
set_signal(&lt;SignalName&gt;, &lt;Count&gt;)
</code></pre>

<p>Emit a global signal <code>&lt;SignalName&gt;</code>.</p>
<p>If <code>&lt;Count&gt;</code> is specified, the signal is emitted <code>&lt;Count&gt;</code> times.</p>
<p><code>&lt;SignalName&gt;</code> is a string, atom, number, or, in fact, any <a href="http://erlang.org/doc/reference_manual/expressions.html#id77790">Erlang term</a>.</p>
<h3 id="wait_signal">wait_signal<a class="headerlink" href="#wait_signal" title="Permanent link">&para;</a></h3>
<pre><code class="python">wait_signal(&lt;SignalName&gt;)
wait_signal(&lt;SignalName&gt;, &lt;Count&gt;)
</code></pre>

<p>Wait for the global signal <code>&lt;SignalName&gt;</code> to be emitted. If <code>&lt;Count&gt;</code> is specified, wait for the signal to be emitted <code>&lt;Count&gt;</code> times.</p>
<h2 id="errors-handling">Errors Handling<a class="headerlink" href="#errors-handling" title="Permanent link">&para;</a></h2>
<h3 id="ignore_failure">ignore_failure<a class="headerlink" href="#ignore_failure" title="Permanent link">&para;</a></h3>
<pre><code class="python">ignore_failure():
    &lt;Statement&gt;
</code></pre>

<p>Execute the statement <code>&lt;Statement&gt;</code> and continue with the benchmark even if it fails.</p>
<p>If the statement succeeds, its result is returned; otherwise, the failure reason is returned.</p>
<h2 id="randomization">Randomization<a class="headerlink" href="#randomization" title="Permanent link">&para;</a></h2>
<h3 id="random_number">random_number<a class="headerlink" href="#random_number" title="Permanent link">&para;</a></h3>
<pre><code class="python">random_number(&lt;Min&gt;, &lt;Max&gt;)
random_number(&lt;Max&gt;)
</code></pre>

<p>Return a random number between <code>&lt;Min&gt;</code> and <code>&lt;Max&gt;</code>, including <code>&lt;Min&gt;</code> and not including <code>&lt;Max&gt;</code>.</p>
<p><code>random_number(&lt;Max&gt;)</code> is equivalent to <code>random_number(0, &lt;Max&gt;)</code></p>
<h3 id="random_list">random_list<a class="headerlink" href="#random_list" title="Permanent link">&para;</a></h3>
<pre><code class="python">random_list(&lt;Size&gt;)
</code></pre>

<p>Return a list of random integer of length <code>&lt;Size&gt;</code>.</p>
<h3 id="random_binary">random_binary<a class="headerlink" href="#random_binary" title="Permanent link">&para;</a></h3>
<pre><code class="python">random_binary(&lt;Size&gt;)
</code></pre>

<p>Return a binary sequence of <code>&lt;Size&gt;</code> random bytes.</p>
<h3 id="choose">choose<a class="headerlink" href="#choose" title="Permanent link">&para;</a></h3>
<pre><code class="python">choose(&lt;N&gt;, &lt;List&gt;)
choose(&lt;List&gt;)
</code></pre>

<p>Return a list of <code>&lt;N&gt;</code> random elements of the list <code>&lt;List&gt;</code>.</p>
<p><code>choose(&lt;List&gt;)</code> is equivalent to <code>choose(1, &lt;List&gt;)</code>.</p>
<h3 id="round_robin">round_robin<a class="headerlink" href="#round_robin" title="Permanent link">&para;</a></h3>
<pre><code class="python">round_robin(&lt;List&gt;)
</code></pre>

<p>Pick the next element of the list. When the last one is picked, start over from the first one.</p>
<p><strong>BEWARE:</strong> The <code>round_robin</code> function complexity is <code>O(n)</code> when <code>n</code> is the length of the <code>&lt;List&gt;</code>, so it is extremely slow for big lists. You should consider to cache the value somehow if it is the case.</p>
<h2 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">&para;</a></h2>
<h3 id="dump">dump<a class="headerlink" href="#dump" title="Permanent link">&para;</a></h3>
<pre><code class="python">dump(&quot;&lt;Text&gt;&quot;)
</code></pre>

<p>Write <code>&lt;Text&gt;</code> to the benchmark log.</p>
<h3 id="sprintf">sprintf<a class="headerlink" href="#sprintf" title="Permanent link">&para;</a></h3>
<pre><code class="python">sprintf(&quot;&lt;Format&gt;&quot;, [&lt;Value1&gt;, &lt;Value2&gt;, ...])
</code></pre>

<p>Return <a href="http://www.erlang.org/doc/man/io.html#fwrite-1">formatted text</a> with a given format and placeholder values.</p>
<h2 id="data-conversion">Data Conversion<a class="headerlink" href="#data-conversion" title="Permanent link">&para;</a></h2>
<h3 id="t">t<a class="headerlink" href="#t" title="Permanent link">&para;</a></h3>
<pre><code class="python">t(&lt;List&gt;)
</code></pre>

<p>Convert <code>&lt;List&gt;</code> to a tuple.</p>
<h3 id="term_to_binary">term_to_binary<a class="headerlink" href="#term_to_binary" title="Permanent link">&para;</a></h3>
<pre><code class="python">term_to_binary(&lt;term&gt;)
</code></pre>

<p>Convert an Erlang term to a binary object. <a href="http://www.erlang.org/doc/man/erlang.html#term_to_binary-1">Learn more</a> in the Erlang docs.</p>
<h2 id="pause">Pause<a class="headerlink" href="#pause" title="Permanent link">&para;</a></h2>
<h3 id="wait">wait<a class="headerlink" href="#wait" title="Permanent link">&para;</a></h3>
<pre><code class="python">wait(&lt;Time&gt;)
</code></pre>

<p>Pause the current job for <a href="#time_1"><code>&lt;Time&gt;</code></a>.</p>
<h1 id="conventions">Conventions<a class="headerlink" href="#conventions" title="Permanent link">&para;</a></h1>
<h2 id="multipliers">Multipliers<a class="headerlink" href="#multipliers" title="Permanent link">&para;</a></h2>
<p>Every numerical constant could be followed by a multiplier letter <code>K</code>, <code>M</code>, <code>G</code> or <code>T</code>. They correspond to 10^3, 10^6, 10^9 and 10^12 respectively.</p>
<pre><code class="python">1.1K # 1100
2.3M # 2300000
0.5G # 500000000
</code></pre>

<h2 id="time_1">Time<a class="headerlink" href="#time_1" title="Permanent link">&para;</a></h2>
<p><strong><code>&lt;Time&gt;</code></strong> is a tuple <code>&lt;Duration&gt; (ms|sec|min|h)</code>:</p>
<pre><code class="python">1 sec # one second
10 min # 10 minutes
0.5 h # half hour
</code></pre>

<h2 id="rate_1">Rate<a class="headerlink" href="#rate_1" title="Permanent link">&para;</a></h2>
<p><strong><code>&lt;Rate&gt;</code></strong> is a tuple <code>&lt;N&gt; (rps|rpm|rph)</code>:</p>
<pre><code class="python">10K rps # 10000 jobs per second
12 rpm # 12 jobs per minute
100 rph # 100 jobs per hour
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
